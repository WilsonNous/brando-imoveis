<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin - Servi√ßos | Brando Im√≥veis</title>

  <meta name="author" content="Brando Im√≥veis - CRECI 61150" />
  <meta name="description" content="Painel administrativo de servi√ßos Brando Im√≥veis | CRECI 61150 | Rua Intendente Ant√¥nio Damasco, 2330 - Ratones / Florian√≥polis." />

  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <link href="/static/css/main.css" rel="stylesheet" />
</head>

<body class="bg-gray-50 text-gray-900 font-sans">

  <!-- ===================================================== -->
  <!-- HEADER -->
  <!-- ===================================================== -->
  <header class="bg-[color:var(--brand-blue)] text-white shadow-md">
    <div class="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center p-4 gap-2">
      <h1 class="text-xl font-bold flex items-center gap-2">
        üõ†Ô∏è Painel de Servi√ßos ‚Äî Brando Im√≥veis
      </h1>
      <div class="flex gap-2">
        <a href="/admin" class="bg-white text-[color:var(--brand-blue)] px-3 py-2 rounded-md hover:bg-gray-100 transition">
          ‚Üê Voltar ao painel principal
        </a>
      </div>
    </div>
  </header>

  <!-- ===================================================== -->
  <!-- CONTE√öDO -->
  <!-- ===================================================== -->
  <main class="max-w-7xl mx-auto p-6">
    <div class="bg-white rounded-xl shadow-md border border-gray-200 overflow-hidden">
      <table class="min-w-full text-sm">
        <thead class="bg-[color:var(--brand-blue)] text-white text-left">
          <tr>
            <th class="py-2 px-3">#</th>
            <th class="py-2 px-3">Cliente</th>
            <th class="py-2 px-3">Im√≥vel</th>
            <th class="py-2 px-3">Servi√ßo</th>
            <th class="py-2 px-3">Descri√ß√£o</th>
            <th class="py-2 px-3">Agendamento</th>
            <th class="py-2 px-3">Status</th>
            <th class="py-2 px-3">A√ß√µes</th>
          </tr>
        </thead>

        <tbody>
          {% for s in servicos %}
          <tr class="border-b hover:bg-gray-50 transition">
            <td class="py-2 px-3">{{ s.id }}</td>
            <td class="py-2 px-3 font-semibold">{{ s.nome_cliente }}</td>

            <!-- Im√≥vel vinculado -->
            <td class="py-2 px-3 text-gray-700">
              {% if s.imovel %}
                <span class="font-medium text-[color:var(--brand-blue)]">{{ s.imovel.codigo }}</span>
                ‚Äî {{ s.imovel.tipo }}<br>
                <small class="text-gray-500">{{ s.imovel.bairro }}</small>
              {% else %}
                <span class="text-gray-400 italic">Sem v√≠nculo</span>
              {% endif %}
            </td>

            <td class="py-2 px-3">{{ s.tipo_servico }}</td>
            <td class="py-2 px-3 text-gray-600">
              {{ s.descricao[:60] }}{% if s.descricao and s.descricao|length > 60 %}...{% endif %}
            </td>

            <td class="py-2 px-3">
              {{ s.data_agendamento.strftime('%d/%m/%Y') if s.data_agendamento else '-' }}
            </td>

            <td class="py-2 px-3">
              <span class="px-2 py-1 rounded text-white text-xs
                {% if s.status == 'pendente' %}bg-gray-400
                {% elif s.status == 'andamento' %}bg-yellow-500
                {% else %}bg-green-600{% endif %}">
                {{ s.status }}
              </span>
            </td>

            <!-- Formul√°rio de atualiza√ß√£o -->
            <td class="py-2 px-3">
              <form method="POST" action="/admin/servicos/update/{{ s.id }}" class="grid grid-cols-1 gap-1">
                <input name="responsavel" placeholder="Respons√°vel" value="{{ s.responsavel or '' }}" class="field text-xs" />
                <input name="data_agendamento" type="date" value="{{ s.data_agendamento.strftime('%Y-%m-%d') if s.data_agendamento else '' }}" class="field text-xs" />
                <input name="materiais" placeholder="Materiais" value="{{ s.materiais or '' }}" class="field text-xs" />

                <!-- üí∞ Custo formatado -->
                <input name="custo" placeholder="Custo ({{ s.custo | brl if s.custo else 'R$ 0,00' }})" 
                       value="{{ s.custo or '' }}" class="field text-xs" />

                <select name="status" class="field text-xs">
                  <option {% if s.status=='pendente' %}selected{% endif %}>pendente</option>
                  <option {% if s.status=='andamento' %}selected{% endif %}>andamento</option>
                  <option {% if s.status=='concluido' %}selected{% endif %}>concluido</option>
                </select>

                <button class="btn-small w-full">üíæ Salvar</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </main>

  <!-- ===================================================== -->
  <!-- RODAP√â -->
  <!-- ===================================================== -->
  <footer class="text-center text-sm text-gray-600 mt-8 italic py-4 border-t border-gray-200">
    ‚ÄúConsagre ao Senhor tudo o que voc√™ faz, e os seus planos ser√£o bem-sucedidos.‚Äù ‚Äî Prov√©rbios 16:3
  </footer>
</body>
</html>
